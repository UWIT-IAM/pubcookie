<html>

<head>
<title>Pubcookie Apache Module - Install Guide</title>
<link rel="stylesheet" href="pubcookie.css" type="text/css">
</head>

<body>

<h1>Pubcookie Apache Module - Install Guide</h1>

                <p>Note: Documentation can contain bugs too. Use the
                   <a href="http://www.pubcookie.org/docs/install-mod_pubcookie-3.0.html">online 
                   version</a> of this document for the most up-to-date information.
                </p>

                <p><i>Included on this page:</i></p>
                  <ul>
                    <li><a href="#obj">Objectives</a></li>
                    <li><a href="#new">What's New</a></li>
                    <li><a href="#upgrading">Upgrading</a></li>
                    <li><a href="#pre">Prerequisites</a></li>
                    <li><a href="#req">System Requirements</a></li>
                    <li><a href="#build">Build Pubcookie</a></li>
                    <li><a href="#install">Install Pubcookie</a></li>
                    <li><a href="#keyclient">Configure &amp; Run Keyclient</a></li>
                    <li><a href="#granting">Download Granting Certificate</a></li>
                    <li><a href="#httpd">Configure &amp; Start Apache (httpd.conf)</a></li>
                    <li><a href="#logout">Logout Configuration and Use</a></li>
                    <li><a href="#test">Test Pubcookie (with sample .htaccess)</a></li>
                    <li><a href="#debug">Troubleshooting</a></li>
                  </ul>
                  <h4><a name="obj">Objectives</a></h4>
                  <p>This guide helps Apache HTTP server administrators install and use the Pubcookie Apache
                     module, mod_pubcookie, henceforth referred to
                     often as <i>the module</i>. Within this guide you will learn how to:</p>
                  <ul>
                    <li><p>Build and install the module for use with either Apache 1.3 or 2.0;</p></li>
                    <li><p>Use the Pubcookie keyclient to obtain an encryption key and retrieve
                      your site's granting certificate;</p></li>
                    <li><p>Configure the module by adding directives to Apache's httpd.conf;</p></li>
                    <li><p>Test the module to confirm that authentication is working.</p></li>
                  </ul>
                  <p>Site administrators should refer to the <a href="install-login.html">login server guide</a> 
                  for instructions on deploying a Pubcookie login server.</p>

                  <h4><a name="new"></a>What's New</h4>
                  <p>Significant changes since mod_pubcookie-3.0.0:</p>
                  <ul>
                    <li> 
                      <p>TBD</p>
                    </li>
                  </ul>
                  <h4><a name="upgrading"></a>Upgrading</h4>
                  <p>Upgrading from mod_pubcookie-3.0.0:</p>
                  <ul>
                    <li>
                      <p>TBD</p>
                    </li>
                  </ul>
                  <h4><a name="pre">Prerequisites</a></h4>
                  <p>Use of this module relies on additional infrastructure at your site.
                  These prerequisites are enumerated and described below.</p>
                  <ul>
                    <li> 
                      <p>To use the module to authenticate users, determine the location of
                        your site's Pubcookie login server. You may also want to find out its version,
                        so that you know what features it supports.</p>
                    </li>
                    <li>
                      <p>To request a DES encryption key for your server, determine the location
                        of your site's Pubcookie keyserver. Ask the administrator to "permit" your 
                        server if necessary; this depends on the keyserver version as well as site policy.</p>
                    </li> 
                    <li>
                      <p>To negotiate the SSL/TLS connection to your keyserver, the SSL certificate 
                        you use with the keyclient utility (often the same server certificate used for
                        SSL) must be issued by a Certificate Authority trusted by your site's keyserver.
                        Similarly, the SSL certificate presented by the keyserver must be issued by a
                        CA that your keyclient trusts. Ask the administrator for guidelines; it'll save
                        you time and effort.</p>
                    </li> 
                    <li> 
                      <p>To verify the "granting" cookies signed and sent by your login
                        server, determine how your site distributes its "granting" certificate. Again,
                        ask the administrator. You may be able to download it via the keyserver, or
                        you may have to obtain it manually.</p>
                    </li> 
                  </ul>
                  <p>These topics will be described in more detail as they come up below.</p>

                  <h4><a name="req">System Requirements</a></h4>

                  <p>The module has the following system requirements:</p>
                  <ul>
                    <li><p>Unix platform.</p></li>
                    <li><p>Accurate system time.</p></li>
                    <li><p><a href="http://httpd.apache.org/">Apache</a> web server. Either 1.3 or 2.0 will do.</p></li>
                    <li><p>SSL enabled web server. The <a href="http://www.modssl.org">mod_ssl</a> 
                      package is recommended. See our <a href="http://www.pubcookie.org/faq.html">FAQ</a>
                      for information about using Apache-SSL.</p></li>
                    <li><p><a href="http://www.openssl.org">OpenSSL</a> library.</p></li>
                    <li><p>SSL keypair. An SSL certificate and private key. [Fixme: PEM encoded? not encrypted?]</p></li>
                    <li><p>Domain name (e.g. <em>appserver.example.edu</em>) registered 
                      in DNS within the same subdomain as your Pubcookie login 
                      server (e.g. <i>weblogin.example.edu</i>). [Fixme: keep? 3.1 can relay.]</p></li>
                  </ul>
                  <h4><a name="build">Build Pubcookie</a></h4>
                  <p>The module can be built as a Dynamic Shared Object (DSO) 
                    or it can be statically linked into Apache itself. 
                    But before you build the module, test your SSL configuration. 
                    The module won't work without SSL support.</p>
                  <p><b>General guidelines for adding SSL support to Apache:</b></p>
                  <p>If your Apache server does not already support SSL, here 
                    are some guidelines for adding it. Note: this is just an overview; 
                    you'll have to look elsewhere for specific instructions if 
                    you need them.</p>
                  <ol>
                    <li> 
                      <p>Build and install OpenSSL.</p>
                    <li> 
                      <p>Build and install Apache from source and add SSL support 
                        by following the directions accompanying the mod_ssl 
                        package. You will have to decide whether to build 
                        modules dynamically or statically. If you use apxs (the 
                        Apache DSO module builder), be sure to link it with OpenSSL. 
                      </p>
                    <li> 
                      <p>Generate a private key and certificate signing request (CSR)
                        to obtain a signed SSL server certificate and install 
                        the private key and server certificate as directed by 
                        the mod_ssl documentation. (Note: You will
                        probably reuse this keypair with Pubcookie's keyclient
                        utility, in which case your cert should be issued by
                        a Certificate Authority trusted by your Pubcookie keyserver.
                        Ask the administrator for guidelines.)</p>
                    <li> 
                      <p>Verify that Apache responds to HTTPS connections. SSL should
                        be working before you proceed to build and install mod_pubcookie.</p>
                  </ol>
                  <p><b>To build mod_pubcookie as a DSO using apxs:</b></p>
                  <ol>
                    <li> 
                      <p>Download the Pubcookie distribution.</p>
                    <li> 
                      <p>Untar a copy of the source, e.g.:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>zcat (download_dir)/pubcookie-3.0.0.tar.gz | tar xf -</pre></TD>
                        </TR>
                      </TABLE></p>
                      
                    <li> 
                      <p>Run the autoconf configure script.</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% ./configure</pre></TD>
                        </TR>
                      </TABLE></p>
                      <p> By default, it creates a Makefile that builds mod_pubcookie.so 
                        and the keyclient utility.</p>
                    <li> 
                      <p>Do a make:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% make</pre></TD>
                        </TR>
                      </TABLE></p>
                      <p> This will build the DSO module and a keyclient binary.</p>
                  </ol>

                  <p><b>To build mod_pubcookie as a built-in (statically linked) 
                    module:</b></p>
                  <ol>
                    <li> 
                      <p><a href="../downloads.html">Download</a> the source distribution.</p>
                    <li> 
                      <p>Untar a copy of the Pubcookie source code, placing it 
                        where you would put other modules, e.g.:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% cd /usr/local/src/apache_1.3.xx/src/modules<br>% zcat (download_dir)/pubcookie-3.0.0.tar.gz | tar xf -</pre></TD>
                        </TR>
                      </TABLE></p>
                    <li> 
                      <p>[Fixme: new --enable-apache-static for static builds!]</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% configure --enable-apache-static</pre></TD>
                        </TR>
                      </TABLE></p>
                      <p>[Fixme: yeah, so now what?]</p>
                    <li> 
                      <p>If you use the top level Apache Configure script, you 
                        will need to add the following option to configure it:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>--activate-module=src/modules/pubcookie-3.0.0/src/mod_pubcookie.a</pre></TD>
                        </TR>
                      </TABLE></p>
                      <p>Or, if you use a src level Configure script, add an AddModule 
                        directive for pubcookie to the Configuration file and 
                        run the Configure script.</p>
                    <li> 
                      <p>After running the configure scripts, do your 'make' to build 
                        a new Apache daemon with the module now statically linked in.</p>
                    <li> Install your new Apache daemon. But complete these installation
                        and configuration instructions before starting it.</p>
                    <li>
                      <p>One more thing: build the keyclient utility too, e.g.:</p>
                      <p>
		      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% cd pubcookie-3.0.0
% ./configure
% make keyclient</pre></TD>
                        </TR>
                      </TABLE></p>
                  </ol>
				  				  
                  <h4><a name="install"></a>Install Pubcookie</h4>
                  <p>In this section, you will install Pubcookie by using, or 
                    mimicing, the Makefile generated by the configure script.</p>
                  <ol>
                    <li> 
                      <p>You can use the Makefile to install Pubcookie:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% make install</pre></TD>
                        </TR>
                      </TABLE></p>
                      <p> Note: If you want to install manually, it's covered in the 
                        next step. Running <tt>make install</tt> will create your Pubcookie 
                        directory, i.e. where Pubcookie stores its supporting files (config file, keys,
                        certs, etc.) The default location is <tt>/usr/local/pubcookie</tt>, 
                        as defined in the configure script. It will also activate 
                        the module by copying the mod_pubcookie.so to the appropirate 
                        location and by modifying your httpd.conf file. [fixme: that's not true in P3.1] You may 
                        want to check that the LoadModule and AddModule directives 
                        landed in the right section of your httpd.conf.</p>
                      <li> 
                      <p>If you prefer to do this work manually, here's what you 
                        need to do to catch up:</p>
                      <ol>
                        <li> 
                          <p> Create your Pubcookie directory and its keys subdirectory:</p>
                          <p> 
                          <table bgcolor="#E0E5F5" border="0" cellspacing="0" cellpadding="5">
                            <tr> 
                              <td> <pre>% mkdir /usr/local/pubcookie
% mkdir /usr/local/pubcookie/keys</pre></td>
                            </tr>
                          </table></p>
                          <p>Non-privileged accounts should not be able to access 
                            files in your Pubcookie directory.</p>
                        <li> 
                          <p>Copy the module to your module library directory. 
                            For example:</p>
                          <p> 
                          <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                            <TR> 
                              <TD> <pre>% cp mod_pubcookie.so /etc/httpd/modules</pre></TD>
                            </TR>
                          </TABLE></p>
                          
                        <li> 
                          <p>Edit your Apache server configuration file (httpd.conf), 
                            adding new LoadModule and AddModule directives to 
                            the appropriate sections. For example:</p>
                          <p> 
                          <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                            <TR> 
                              <TD> <pre>&lt;IfDefine HAVE_SSL&gt;
LoadModule ssl_module         modules/libssl.so
LoadModule pubcookie_module   modules/mod_pubcookie.so
&lt;/IfDefine&gt;

...

&lt;IfDefine HAVE_SSL&gt;
AddModule mod_ssl.c
AddModule mod_pubcookie.c
&lt;/IfDefine&gt;</pre></TD>
                            </TR>
                          </TABLE></p>
                          <p>Again, this is just an example. Your httpd.conf may 
                            differ.</p>
                          <p><b>Warning</b>: if your LoadModule and AddModule directives 
                            are placed within an &lt;IfDefine HAVE_SSL&gt; block 
                            directive, all Pubcookie run-time directives must 
                            also be placed with an &lt;IfDefine HAVE_SSL&gt; block 
                            directive.</p>
                      </ol>
                  </ol>

                  <!-- keyclient section -->

		  <h4><a name="keyclient">Configure &amp; Run Keyclient</a></h4>

                  <p>Pubookie uses a keyserver to distribute encryption keys 
                    and, oppitionally, a site's "granting" certificate to participating application servers. 
                    This section describes how to configure and run the keyclient utility 
                    to negotiate a key from your local keyserver.</p>

                  <p>Note: keyclient configuration depends on local practices, so contact 
                    your administrator for tips and recommendations.</p>

                  <p><b>To create a configuration file for the keyclient:</b></p>

                  <ol>
                    <li> 
                      <p>Create and edit your keyclient config file:</p>
                    </li>
                    <p> 
                    <table bgcolor="#E0E5F5" border="0" cellspacing="0" cellpadding="5">
                      <tr> 
                        <td> <pre>% pico /usr/local/pubcookie/config</pre></td>
                      </tr>
                    </table></p>
                    <p>[fixme: should this be keyclient.conf?] </p>
                    <li>
                      <p>Add the following <a href="config.html">configuration variables</a>
                        and adjust their values according to your site: 
                        [fixme: config.sample may be outdated]</p>
                    <p> 
                    <table bgcolor="#E0E5F5" border="0" cellspacing="0" cellpadding="5">
                      <tr> 
                        <td> <pre># ssl config
ssl_key_file: /etc/httpd/conf/ssl.key/server.key
ssl_cert_file: /etc/httpd/conf/ssl.crt/server.crt

# keyclient-specific config
keymgt_uri: https://weblogin.example.edu:2222
ssl_ca_file: /etc/httpd/conf/ssl.crt/ca-bundle.crt
</pre></td>
                      </tr>
                    </table></p>
                    <p>Note: To negotiate the SSL/TLS connection to your keyserver, the SSL 
                      certificate used by the keyclient (i.e., <tt>ssl_cert_file</tt>) 
                      must be signed by a Certificate Authority trusted by your site's keyserver. 
                      Likewise, the certificate presented by the keyserver to the keyclient
                      must be signed by a CA trusted by your keyclient (i.e., via <tt>ssl_ca_file</tt>  
                      or <tt>ssl_ca_path</tt>). Ask your administrator for guidelines; they may
                      recommend or require specific CAs.</p>
                    <p>Warning: the keyclient utility cannot read RSA private keys encrypted with a
                      passphrase. To run keyclient, your <tt>ssl_key_file</tt> cannot require a password.</p>
                    <li> 
                      <p>Save the changes to your new keyclient config file.</p>
                    </li>
                  </ol>
				  
                  <p><b>To request a new encryption key for your server:</b></p>
                  <ol>
                    <li>
                      <p>Ask the keyserver administrator to "permit" your server if necessary to
                        request a key; this depends on the local policy for server registration 
                        as well as the version of keyserver being used.</p>
                    </li> 
                    <li> 
                      <p>Run the keyclient utility to request a new DES key:</p>
                      <p> 
                      <table bgcolor="#E0E5F5" border="0" cellspacing="0" cellpadding="5">
                        <tr> 
                          <td> <pre>% keyclient</pre></td>
                        </tr>
                      </table>
                      </p>
                      <p>The keyclient will use the run-time settings defined by your keyclient configuration 
                      file.</p>
                      <p>Note: keyclient cannot read RSA private keys that have been encrypted 
                      with a pass phrase. If reading your key (i.e., <tt>ssl_key_file</tt>) normally 
                      requires a password, then keyclient will fail, complaining that it 
                      couldn't parse the session key. [fixme: better check on that msg.] To work
                      around this contraint, make a temporary copy of your private key without the 
                      pass phrase on it.</p>
                    <li>
                      <p>If successful, keyclient will save the key in your keys directory 
                        in a file named after the Common Name defined in your server certificate 
                        (i.e., <tt>ssl_cert_file</tt>). List the contents of your keys directory to 
                        find the new key:</p>
                      <p> 
                      <table bgcolor="#E0E5F5" border="0" cellspacing="0" cellpadding="5">
                        <tr> 
                          <td> <pre>% ls /usr/local/pubcookie/keys
appserver.example.edu</pre></td>
                        </tr>
                      </table></p>
                      <p>If keyclient is not successful, note any error messages and refer 
                        to the <a href="#debug">troubleshooting</a> section below.</p>
                  </ol>

                  <h4><a name="granting">Download Granting Certificate</a></h4>

                  <p>The Pubcookie module uses your login server's "granting" certificate to verify the
                    signature of the "granting" cookies sent from your login server to your
                    application server.</p>

                  <ol>
		    <li>
                      <p>Run keyclient with the <tt>-G</tt> option to retrieve your site's
                        "granting" certificate.
                      <p>
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% keyclient -G /usr/local/pubcookie/keys/pubcookie_granting.cert</pre></TD>
                        </TR>
                      </TABLE></p>
		    </li> 
		    <li> 
                      <p>If keyclient cannot download your "granting" certificate, your keyserver
                         may not support this method and you'll have to obtain a copy manually.</p>
		    </li> 

		  </ol>
                  <p>Note: During configuration, this certificate corresponds with 
                    the <a href="mod_pubcookie-directives.html#PubcookieGrantingCertFile">PubcookieGrantingCertFile</a>
                    directive in httpd.conf. It also corresponds with the <tt>granting_cert_file</tt> config
                    file variable, which is only necessary if you choose a
                    filename other than pubcookie_granting.cert. [fixme: does keyclient
                    run without this config variable?]</p>

                  <h4><a name="httpd"></a>Configure &amp; Start Apache (httpd.conf)</h4>
                  <p>The Pubcookie module is initially configured by directives
                    in the Apache config files. In this section you will 
                    add the necessary directives to your httpd.conf file.</p>
                  <ol>
                    <li> 
                      <p>Edit your Apache server configuration file (httpd.conf), 
                        e.g.:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% pico httpd.conf</pre></TD>
                        </TR>
                      </TABLE>
                      <p></p>
                    <li> 
                      <p>Add a new section in httpd.conf for configuring the module:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>&lt;IfDefine HAVE_SSL&gt;
&lt;IfModule mod_pubcookie.c&gt;

#
# Pubcookie configuration section
#

PubcookieGrantingCertFile /usr/local/pubcookie/keys/pubcookie_granting.cert
PubcookieSessionKeyFile /etc/httpd/conf/ssl.key/appserver.key
PubcookieSessionCertfile /etc/httpd/conf/ssl.crt/appserver.crt
PubcookieLogin https://weblogin.example.edu/
PubcookieDomain .example.edu
PubcookieKeyDir /usr/local/pubcookie/keys/
PubcookieAuthTypeNames EGNetID

# Disable inactivity timeout by default
&lt;Directory "/var/www/html"&gt;
PubcookieInactiveExpire -1
&lt;/Directory&gt;


&lt;/IfModule&gt;
&lt;/IfDefine&gt;</pre></TD>
                        </TR>
                      </TABLE>

                      <p>Refer to the <a href="mod_pubcookie-directives.html">mod_pubcookie run-time configuration
                      directives</a> for general descriptions of each. Here are some significant notes:</p>

                      <ul>
                      <li>
                        <p>Each directive above is recommended, although they're not all required to 
                        start Apache. [fixme: can we be more specific?]</p>
                      </li>
                      <li>
                        <p><a href="mod_pubcookie-directives.html#PubcookieAuthTypeNames">PubcookieAuthTypeNames</a>
                        defines the strings that the module enables as additional arguments to 
                        the <a href="mod_pubcookie-directives.html#AuthType">AuthType</a> directive. (<tt>EGNetID</tt>
                        just happens to be what they use at Example State University.)</p>
                      </li>
                      <li>
                        <p>Turning off the inactivity expiration via the <a 
                        href="mod_pubcookie-directives.html#PubcookieInactiveExpire">PubcookieInactiveExpire</a>
                        directive provides a modest performance boost, since session cookies don't
                        have to be signed so often. Applications that require an inactivity timeout can 
                        always override this default setting.</p>
                      </li>
                      <li>
                        <p><b>Warning</b>: if your LoadModule and AddModule directives are 
                        placed within an &lt;IfDefine HAVE_SSL&gt; block directive, then
                        all Pubcookie configuration directives must also be placed 
                        within an &lt;IfDefine HAVE_SSL&gt; block directive. This is the
                        convention used throughout this guide.</p>
                      </li>
                      <li>
                        <p>[fixme: permissions on cert/keyfile - what's required? also, can 
                        PubcookieSessionKeyfile be encrypted with a pass phrase?]
                      </li>
                    </ul>
                    <li> 
                      <p>Take this opportunity also to add any other system-wide 
                        configuration you want for your Pubcookie application 
                        server, such as default timeout lengths. See the <a 
                        href="mod_pubcookie-directives.html">mod_pubcookie run-time 
                        configuration directives</a> reference for the various 
                        possibilities.</p>
                    <li> 

                      <p>Now enable the use of the module's per-application
                        configuration directives inside .htaccess files and
                        &lt;Directory&gt; and &lt;Location&gt; block directives. To
                        do so, set your server's <a 
href="http://httpd.apache.org/docs/mod/core.html#allowoverride">AllowOverride</a> 
                        setting to <tt>AuthConfig</tt>:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>AllowOverride AuthConfig</pre></TD>
                        </TR>
                      </TABLE></p>
                      
                    <li> 
                      <p>Save the changes to your httpd.conf file.</p>
                    <li>
                      <p>Start or restart your server.</p>
                  </ol>
                  <p><b>Optional Recommended Configuration For Abbreviated Domain 
                    Names</b></p>
                  <p>Because HTTP cookies must be scoped to a specific fully-qualified 
                    domain, the use of abbreviated domain names (e.g. "<em>appserver</em>" 
                    instead of "<em>appserver.example.edu</em>") affects the sending 
                    of cookies, which in turn affects, and causes problems for, 
                    Pubcookie. To remedy this, you might use <a
href="http://www.apache.org/docs/mod/mod_rewrite.html">mod_rewrite</a> to rewrite 
                    (and redirect) abbreviated domain names to fully-qualified 
                    domain names. Here is a sample configuration (for httpd.conf):</p>
                  <p> 
                  <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                    <TR> 
                      <TD> <pre>RewriteEngine on
RewriteCond %{HTTP_HOST} !^$
RewriteCond %{HTTP_HOST} !\.example\.edu
RewriteRule ^/(.*)$ https://%{SERVER_NAME}/$1 [L,R]</pre></TD>
                    </TR>
                  </TABLE>
                  </p>
                  <p>This rule is for a https requests only; you would need something 
                    similar for http requests. You may also need to add additional 
                    rules for subdomains (e.g. <i>subdomain.example.edu</i>). 
                    Additionally, abbreviated domain names must be in your ServerAlias 
                    list.</p>
					
                  <h4><a name="logout">Logout Configuration and Use</a></h4>
                  <p>The <a href="mod_pubcookie-directives.html#PubcookieEndSession">PubcookieEndSession</a> 
                  directive causes the module 
                  to clear the current session cookie. Therefore, it is used to implement
                  application logout. This directive can be configured on a per-application
                  basis using .htaccess or configured centrally to create a virtual logout
                  URI that any application on the server can link to in order to implement 
                  its own logout function without the need for .htaccess.</p>

                  <p><b>To configure logout using .htaccess:</b></p>
                  <p>The simplest way to configure logout for an application or static website
                  is to place a .htaccess file in a subdirectory (e.g. <tt>logout</tt>) and put a 
                  PubcookieEndSession in the .htaccess file. It might be laid out something like
                  this:</p>
                  <p> 
                  <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                    <TR> 
                      <TD><pre>$ ls -a
.htaccess    images/    index.php    other.php    logout/
$ more .htaccess
PubcookieAppID testapp
Authtype EGNetID
require valid-user
$ more logout/.htaccess
PubcookieEndSession redirect</pre></TD>
                    </TR>
                  </TABLE></p>
                  <p>Then a link from any page to the subdirectory will steer users to logout, 
                  allowing PubcookieEndSession to do its work.</p>
                  <p> 
                  <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                    <TR> 
                      <TD><pre>&lt;a href="logout/"&gt;Logout&lt;/a&gt;</pre></TD>
                    </TR>
                  </TABLE></p>

                  <p><b>To configure and use a matching logout URI:</b></p>
                  <p>This is a nice alternative for sysadmins and application deployers who 
                  prefer not to use subdirectories and .htaccess files to configure
                  logout. Essentially, by using Apache's <a href="http://httpd.apache.org/docs/mod/core.html#locationmatch">LocationMatch</a> 
                  directive you can create a server-wide matching string that causes the module to
                  invoke <a href="mod_pubcookie-directives.html#PubcookieEndSession">PubcookieEndSession</a> 
                  without the use of .htaccess;
                  simply by creating a link with the same string in it, an application 
                  can implement logout. Here's example httpd.conf configuration which defines
                  two such strings, <tt>LOGOUT-REDIRECT</tt> and <tt>LOGOUT-CLEARLOGIN</tt>,
                  corresponding with two styles of application logout provided by Pubcookie.</p>
                  <p> 
                  <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                    <TR> 
                          <TD> <pre>&lt;IfDefine HAVE_SSL&gt;
&lt;IfModule mod_pubcookie.c&gt;

#
# Pubcookie configuration section
#

...

#
# Pubcookie logout configuration
#

&lt;LocationMatch .*/LOGOUT-REDIRECT.*&gt;
AuthType EGNetID
require valid-user
PubcookieEndSession redirect
&lt;/LocationMatch>
&lt;LocationMatch .*/LOGOUT-CLEARLOGIN.*&gt;
AuthType EGNetID
require valid-user
PubcookieEndSession clearLogin
&lt;/LocationMatch&gt;

&lt;/IfModule mod_pubcookie.c&gt;
&lt;/IfDefine&gt;</pre></TD>
                    </TR>
                  </TABLE>
                  </p>
                  <p>With this in place, and the server restarted, any Pubcookie-protected application
                  or static website on the server can now implement logout simply by linking to one of 
                  these virtual URIs. For example:</p>
                  <p> 
                  <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                    <TR> 
                      <TD><pre>&lt;a href="LOGOUT-REDIRECT"&gt;Logout&lt;/a&gt;</pre></TD>
                    </TR>
                  </TABLE></p>

                  <h4><a name="test">Test Pubcookie (with sample .htaccess)</a></h4>
                  <ol>
                    <li> 
                      <p>Create a new directory within your DocumentRoot. For 
                        example:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>% cd /var/www/html
% mkdir testapp
% cd testapp</pre></TD>
                        </TR>
                      </TABLE>
                      <p></p>
                    <li> 
                      <p>In this directory, create a new Web page:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>pico index.html</pre></TD>
                        </TR>
                      </TABLE>
                      <p></p>
                      <p>Add a simple message to the file such as "Hello world 
                        - I'm Pubcookie-protected!!" and then save it.</p>
                    <li> 
                      <p>Create a .htaccess file:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>pico .htaccess</pre></TD>
                        </TR>
                      </TABLE>
                      <p></p>
                    <li> 
                      <p>Add the following directives to the .htaccess file:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>AuthType EGNetID
require valid-user</pre></TD>
                        </TR>
                      </TABLE>
                      <p></p>
                      <p>Substitute the appropriate argument for the AuthType 
                        directive, based on the string you defined with the 
                        PubcookieAuthTypeNames directive in your httpd.conf (see above). 
                        Note that using these directives in the .htaccess file context
                        requires the <tt>AllowOverride AuthConfig</tt> setting (also 
                        mentioned above).</p>
                    <li> 
                      <p>Start a Web browser and open the address for the test 
                        directory, e.g.:</p>
                      <p> 
                      <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                        <TR> 
                          <TD> <pre>https://appserver.example.edu/testapp/</pre></TD>
                        </TR>
                      </TABLE></p>
                      <p>You should be redirected to your Pubcookie login server.</p>
                    <li> 
                      <p>When you log in as requested, you will be redirected 
                        back to the test directory and you should see your "Hello 
                        world!" message. If you do, you have successfully installed 
                        and configured Pubcookie. Congratulations!</p>
                    <li>
                      <p>If this test is unsuccessful, refer to the <a href="#debug">troubleshooting</a> 
                        section below.</p>
                    
                  </ol>
		  <h4><a name="debug"></a>Troubleshooting</h4>
		  <p>To troubleshoot problems with keyclient, review the error messages
                    it produces [fixme: does it send anything to syslog???] and if need be
                    ask your keyserver administrator to review syslog for error messages
                    corresponding with your keyclient connections.
                  </p>
		  <p>To troubleshoot problems with the module, look in your Apache 
                    server's error_log. If need be, edit your Apache httpd.conf 
                    file and turn on the debug mode (requires server restart) 
                    to get additional information:</p>
		  <p> 
                    <TABLE BGCOLOR="#E0E5F5" BORDER="0" CELLSPACING="0" CELLPADDING="5">
                      <TR> 
                        <TD> <pre>LogLevel: debug</pre></TD>
                      </TR>
                    </TABLE>
                  </p>
</BODY>
</HTML>
