<html>
	<head>
		<title>Pubcookie ISAPI Filter - Install Guide</title>
		<link rel="stylesheet" href="pubcookie.css" type="text/css" title="pubcookie">
	</head>
	<body>
		<h1>Pubcookie ISAPI Filter - Install Guide</h1>
		<p>Note: Documentation can contain bugs too. The <a href="http://www.pubcookie.org/docs/install-filter.html">
				online version of this document</a> is always the most up-to-date version.
		</p>
		<p><i>Included on this page:</i></p>
		<ul>
			<li>
				<a href="#overview">Overview</a>
			<li>
				<a href="#news">What's New</a>
			<li>
				<a href="#prereq">Prerequisites</a>
			<li>
				<a href="#sysreq">System Requirements</a>
			<li>
				<a href="#install">Install Pubcookie</a>
			<li>
				<a href="#clusters">Clustered Host Configuration</a>
			<li>
				<a href="#vhosts">Virtual Host Configuration</a>
			<li>
				<a href="#relay">Cross-Domain Relay Configuration</a>
			<li>
				<a href="#upgrade">Upgrading</a></li>
		</ul>
		<h4><a name="overview">Overview</a></h4>
		<p>This guide helps Microsoft IIS server administrators install the Pubcookie ISAPI 
			filter, herein referred to as simply <i>the filter</i>.</p>
		<h4><a name="news">What's New</a></h4>
		<P>Significant improvements since version 3.0.0:</P>
		<UL>
			<LI>
				New Pubcookie.msi installer.
			<LI>
				New IIS MMC extension for GUI-based configuration tabs.
			<LI>
				<A href="#vhosts">Virtual host support</A>
			<LI>
				<A href="#relay">Cross-DNS-domain relay</A>
			<LI>
				New <A href="mod_pubcookie-directives.html#PubcookieNoPrompt">No_Prompt</A>
			directive
			<LI>
				Enhanced <A href="mod_pubcookie-directives.html#PubcookieSessionCauseReAuth">Session_Reauth</A>
			with grace time
			<LI>
				New <TT>keyclient -G</TT>
			option to download granting certificate
			<LI>
			Improved OpenSSL compatibility
			<LI>
				Revised, improved documentation
			</LI>
		</UL>
		<P>Note: some new features require a Pubcookie 3.1.0 or higher login server.</P>
		<h4><a name="prereq">Prerequisites</a></h4>
		<p>The filter relies on additional infrastructure at your site. Here are some 
			general prerequisites that, if fulfilled, will lead to a smooth, successful 
			installation.</p>
		<ul>
			<li>
				<p>Determine the location of your site's Pubcookie login server. The installer 
					needs this URL during installation. You may also want to find out its version, 
					so that you know what features it supports.</p>
			<li>
				<p>Determine the location of your site's Pubcookie keyserver. The installer needs 
					this URL to request a symmetric encryption key that your server will share with 
					your login server. Depending on the keyserver version and site policy, you may 
					also need to ask your administrator to "permit" your server to request keys.</p>
			<li>
				<p>Determine how trust is handled by your site's Pubcookie keyserver. You'll need 
					to know which Certificate Authorities the keyserver trusts to verify 
					certificates. Similarly, you'll need to know which Certificate Authority can 
					verify the keyserver's certificate. Ask your administrator for guidelines; 
					it'll save you time and effort.</p>
			<li>
				<p>Determine how your site distributes its Pubcookie "granting" certificate. The 
					installer needs a copy of this certificate to verify the "granting" cookies 
					signed and sent by your site's login server. The installer may be able to 
					download it from your keyserver, or you may have to obtain it manually. Ask 
					your administrator which method to use.</p>
			</li>
		</ul>
		<p>Note: Review the sections on <a href="#vhosts">virtual host configuration</a> or
                   <a href="#clusters">clustered host configuration</a> now if either of those scenarios apply. 
			The information will help you think about and tailor the installation as 
			needed.</p>
		<h4><a name="sysreq">System Requirements</a></h4>
		<p>The Pubcookie ISAPI filter has the following system requirements:</p>
		<ul>
			<li>
				<p>Microsoft Windows&nbsp;2000 or later</p>
			<li>
				<p>Microsoft Internet Information Server (IIS) 4.0 or later</p>
			<li>
				<p>Accurate system time</p>
			<li>
				<p>Domain name registered in DNS (e.g. <i>appserver.example.edu</i>).</p>
				<p>Note: If your server doesn't share a common DNS subdomain (e.g. <i>.example.edu</i>) 
					with your site's Pubcookie login server (e.g. <i>weblogin.example.edu</i>) or if
                                        your enterprise domain is in a country code top-level domain (e.g.
                                        <i>example.ca</i>) you will have to install and use the Pubcookie relay cgi to
                                        authenticate across DNS domains. Review the <a href="#relay">relay configuration</a>
                                        section now to prepare for this case.</p>
			<LI>
				<P>An SSL enabled web site. All intended users should be able to reach your website 
					via HTTPS at your registered DNS name without errors.</P>
			<LI>
				<P>The <tt>System32\Inetsrv</tt> folder should be world writable or writable by the 
					administrator account running the installer.</P>
			</LI>
		</ul>
		<h4><a name="install">Install Pubcookie</a></h4>
		<p>Open the pubcookie.msi package as the administrator user or as an account with 
			administrator privileges. The installer needs to create folders and files in 
			the <tt>System32\Inetsrv</tt> folder as well as to stop and start system 
			services.</p>
		<p>A typical installation has several stages:</p>
		<ol>
			<li>
				<p>The installer first allows you to decide to install Pubcookie, or to modify, repair, or remove Pubcookie if it 
					is already installed.</p>
			<li>
				<p>During installation, the Site Information screen collects site information. Here you'll be able to specify your server name, 
					Pubcookie login server and keyserver locations, enterprise domain, and 
					authentication types.&nbsp; Make sure that your server&nbsp;name matches the 
					certificate you installed when you set up SSL for your web site.&nbsp;</p>
			<LI>
				<P>The Custom Setup screen lets you select the ISAPI Filter and basic test Webapp for installation. You may change 
					the installation directory and change installed components. (If you need to use the Pubcookie 
                                        relay, select it to be installed; it is unselected by default.)</P>
			<li>
				<p>The installer is now ready to do the install. Click the Install button. The installer will add the Pubcookie filter to the IIS root 
					filter list and restart IIS services. It will aslo use your server name to 
					locate your SSL key pair from the&nbsp;Personal Certificate store and use them, 
					along with your installed Certificate Authority certificates, to negotiate a 
					symmetric key from your keyserver and download your site's "granting" 
					certificate.</p>
			</li>
		</ol>
		<p>Note: to request a key from your keyserver you may have to ask your keyserver 
			administrator to "permit" your host. Also, you'll need to be able to verify the 
			keyserver's SSL certificate with the CA certificates installed on your system. 
			Ask your keyserver administrator if you need a special CA certificate to do 
			that.</p>
		<h4><a name="clusters">Clustered Host Configuration</a></h4>
		<p>For clustered host configurations, run the installer on each host. After running 
			the install on the last host, copy the symmetric key (by default from <tt>System32\Inetsrv\Pubcookie\keys\</tt>) 
			on the last host installed to each of the other hosts. This will syncronize the 
			cluster with the key stored on the login server.</p>
		<h4><a name="vhosts">Virtual Host Configuration</a></h4>
		<P>If clients can connect to your web site(s) using more than one server name, you 
			will need to run keyclient.exe for each of the names in addition to the one you 
			specified during the installation process.&nbsp; By default, keyclient.exe 
			resides in <TT>System32\Inetsrv\Pubcookie\.</TT>&nbsp; The syntax to create a 
			new virtual host encryption key is:</P>
		<P><TT>keyclient -H &lt;hostname&gt;</TT></P>
		<P>where <tt>&lt;hostname&gt;</tt> is replaced with your virtial host name.
			Since Pubcookie uses SSL encryption, you will need to have SSL access properly 
			set up for each virtual host.</P>
		<h4><a name="relay">Cross-Domain Relay Configuration</a></h4>
                <p>To install the optional Pubcookie relay for cross-DNS-domain authentication, select the
                        Relay component from the installer's Custom Setup screen. If selected, the installer 
                        adds it to your default website. Look for the <tt>PBC_RELAY</tt> folder in your web root 
                        folder; it contains the
                        relay cgi executable itself and some necessary templates. The relay cgi will pick up
                        you default configuration settings and should be ready for use after installation.</p>
                <p>To configure a web resource that needs to use the relay, use the IIS Service Manager to modify the the 
                        Login_URI directive to point to the relay rather than the real login server URL, which is presumably 
                        across DNS domains and therefore can't be used directly.  For example, to configure the example WebApp
                        to use the relay, find, select, and open the properties for the WebApp folder. On the Pubcookie
                        Directives tab, set the "Login_URI" directive to point to the relay cgi on your application server.
                        For example, if your application server is <i>remote.site.org</i> and your login server is
                        <i>weblogin.example.edu</i>, then use <tt>https://remote.site.org/pbc_relay/index.cgi?domain=remote.site.org</tt> 
                        for the "Login_URI". When you request the WebApp, you'll be redirected to the relay; the relay will 
                        pick up the actual location of your login server from your default configuration settings (set during
                        installation) and get you there and back again.</p>
                <p>Note: The relay accepts the <tt>domain</tt> argument to allow a single relay to serve multiple 
                        servers and multiple domains, but in the simple case where the resource and relay reside on the
                        same host, this argument is simply the server domain. In its absense, the relay will fall back to 
                        reading the <tt>enterprise_domain</tt> directive.</p>
                        
		<h4><a name="upgrade">Upgrading</a></h4>
		<p>For the cleanest upgrade from an earlier version of Pubcookie, remove previous 
			versions before installing the current one.</p>
		<P>To remove previous versions (optional):</P>
		<ol>
			<li>
				<p>Stop IIS.</p>
			<li>
				<p>Back up and remove your existing <tt>System32\Inetsrv\Pubcookie</tt> folder.</p>
			<LI>
				<P>Start IIS.</P>
			</LI>
		</ol>
		<P>Then run the installer for Pubcookie 3.1</P>
		<p>Note: the installer won't overwrite the web properties (registry settings) 
			you've assigned to your website, folders, or resources. It will 
			however&nbsp;update the filter variables according to the login server and 
			keyserver URLs you provide to the installer.</p>
		<hr>
		<p>
			Copyright 1999-2004, University of Washington. All rights reserved.<br>
			See doc/LICENSE.txt for terms of use.
		</p>
	</body>
</html>
