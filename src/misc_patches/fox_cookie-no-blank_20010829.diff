34,37c34,37
< #include <openssl/pem.h>
< #include <openssl/des.h>
< #include <openssl/rand.h>
< #include <openssl/err.h>
---
> #include <pem.h>
> #include <des.h>
> #include <rand.h>
> #include <err.h>
67d66
<   int                   noblank;
309,312d307
<   pubcookie_server_rec *scfg;
<   scfg = (pubcookie_server_rec *) ap_get_module_config(r->server->module_config,
<                                          &pubcookie_module);
<   if (scfg->noblank) return(0);
1112,1113c1107
<       if( scfg->super_debug )
<          libpbc_debug("pubcookie_user: no G or S cookie; uri: %s\n", r->uri);
---
>       libpbc_debug("pubcookie_user: no G or S cookie; uri: %s\n", r->uri);
1272c1266,1267
<   if( (cfg->creds&(*cookie_data).broken.creds) != cfg->creds) {
---
>   if( check_creds( atoi(&cfg->creds), atoi(&(*cookie_data).broken.creds) )
> 		== PBC_FAIL ) {
1352,1353c1347
<   if( scfg->super_debug )
<      ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG,r,"in typer, creds=0x%x",(int)cfg->creds);
---
>   ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG,r,"in typer, creds=0x%x",(int)cfg->creds);
1781,1802d1774
< /* allow admin to set a "dont blank the cookie" mode
<    for proxy with pubcookie */
< const char *pubcookie_set_no_blank(cmd_parms *cmd, void *mconfig, char *v) {
<     server_rec *s = cmd->server;
<     pubcookie_server_rec *scfg;
< #ifdef APACHE1_2
<     pool *p = cmd->pool;
<
<     scfg = (pubcookie_server_rec *) get_module_config(s->module_config,
<                                                    &pubcookie_module);
< #else
<     ap_pool *p = cmd->pool;
<
<     scfg = (pubcookie_server_rec *) ap_get_module_config(s->module_config,
<                                                    &pubcookie_module);
< #endif
<
<     scfg->noblank = 1;
<
<     return NULL;
< }
<
1826a1799
> /* we turn off ForceReauth because it sucks anyway
1829,1830c1802
<     {"PubCookieNoBlank", pubcookie_set_no_blank, NULL, OR_OPTIONS, TAKE1,
<      "Do not blank cookies."},
---
> */
